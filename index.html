<!DOCTYPE html>

<html>
	<!--
		v1.0 - Copyright 2012-2013 IrelandOffline - http://irelandoffline.org/
		See licence & source code at https://github.com/cgarvey/ioffl-combinedmap
        v1.1 wisp overlays
	-->
	<head>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<title>Broadband viewer</title>

		<link rel=stylesheet href='form_demo23.css' type='text/css'>
		<style type="text/css">
			#map_canvas { height: 100% }
		</style>

		<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
		<script type="text/javascript">

		    var currentLayer = null;
		    var layer = null;
		    var layer1 = null;
		    var layer2 = null;
		    var marker = "null"
		    var circle = null;
		    var crosshair = null;
		    var wispsArray = []


		    function initialize() {
		        // Set centre of map
		        var athlone = new google.maps.LatLng(53.5, -7.5);
		        // Set background map, centre, zoom level, type
		        map = new google.maps.Map(document.getElementById('map_canvas'), {
		            center: athlone,
		            zoom: 7,
		            mapTypeId: 'roadmap'
		        });

		        // Add a Circle overlay to the map.
		        circle = new google.maps.Circle({
		            map: map,
		            radius: 3500, // 3.5 kms
		            strokeWeight: 0,
		            stokeOpacity: 0
		        });

		        crosshair = new google.maps.MarkerImage('marker.png',
									// This marker is 10 pixels wide by 10 pixels tall.
					new google.maps.Size(10, 10),
									// The origin for this image is 0,0.
					new google.maps.Point(0, 0),
									// The anchor for this image is at the base at 5,5.
					new google.maps.Point(5, 5)
				);

		        marker = new google.maps.Marker({
		            icon: crosshair,
		            map: map,
		            position: new google.maps.LatLng(53.5, -10.5),
		            draggable: true,
		            title: 'Drag to your location 3.5 kms'
		        });

		        circle.bindTo('center', marker, 'position');
		    }
		    //Function brings circle marker to centre of screen
		    function fetchMarker() {
		        marker.position = map.getCenter(),
				circle.bindTo('center', marker, 'position');
		        marker.setMap(map);
		    }

		    // SECTION ON MOBILE NETWORKS AND PLATFORMS

		    // Function to create SQL query string from checked boxes of a form FormNo

		    function formScan(formNo) {

		        var i;
		        txtOut = "";
		        for (i = 0; i < document.forms[formNo].length; i++) {
		            if (document.forms[formNo].elements[i].checked) txtOut = txtOut + document.forms[formNo].elements[i].value;
		            else txtOut = txtOut + "";
		        }
		        return txtOut;
		    }
		    // Function combines Network, Platform queries of the Mobile Sites Fusion table.
		    function MakeQuery() {

		        CombQry = ""
		        CombQry = "'Network' IN (" + formScan(0) + "'f')" + formScan(1);
		        currentLayer = layer2
		        clearLayer();

		        layer2 = new google.maps.FusionTablesLayer(5488684, { query: "SELECT Location FROM 5488684 WHERE " + CombQry });
		        stackLayers();
		        currentLayer = layer2;
		    }
		    // Function queries the Eircom exchanges Fusion Table
		    function compQuery() {
		        currentLayer = layer;
		        clearLayer();

		        exchQry = "(" + formScan(2) + "'f')";
		        layer = new google.maps.FusionTablesLayer(1888694, { query: "SELECT Location FROM 1888694 WHERE 'Enabled' IN" + exchQry });
		        stackLayers();
		        currentLayer = layer;
		    }
		    //SECTION ON UNDERLAYS
		    // Function sets underlay based on radio button choice of Form AreaOverlay
		    function overlay(layerNo, dataset, querytxt) {
		        currentLayer = layerNo;
		        clearLayer();
		        layer1 = new google.maps.FusionTablesLayer(dataset, { query: querytxt });
		        stackLayers();
		        currentLayer = layerNo;
		    }
		    //SECTION ON MANAGING LAYERS

		    function stackLayers() {
		        if (layer1 != null) layer1.setMap(map);
		        if (layer != null) layer.setMap(map);
		        if (layer2 != null) layer2.setMap(map);
		    }

		    function clearAllLayers() {
		        if (layer) layer.setMap(null);
		        if (layer1) layer1.setMap(null);
		        if (layer2) layer2.setMap(null);
		    }

		    function clearLayer() {
		        if (currentLayer != null) currentLayer.setMap(null);
		    }
		    //SECTION ON GROUNDOVERLAYS FOR FWAs AND WISPS

		    // Creates overlay. Updates the overlay array.
		    function newLayer(North, South, East, West, vis, overLayLink) {

		        var imageBounds = new google.maps.LatLngBounds(
                    new google.maps.LatLng(South, West),
                    new google.maps.LatLng(North, East));

		        var overlayOpts = {
		            opacity: vis
		        }

		        var wisp = new google.maps.GroundOverlay(
                                overLayLink, imageBounds, overlayOpts);
		        wispsArray.push(wisp);
		        wisp.setMap(map);
		    }
		    //Checks whether FWA checkbox is ticked
		    function checkedState() {

		        if (document.getElementById("idWISPs").checked) {
		            loadGroundOverlays();
		        }
		        else {
		            clearOverlays();
		        }
		    }
		    // Loads all overlays onto map
		    function loadGroundOverlays() {

		        newLayer(52.17259, 51.27235, -8.3619661, -10.12707, 0.9, "https://dl.dropbox.com/u/39502907/net-cov.png");
		        newLayer(54.52309, 53.17326, -8.289186, -10.29116, 0.5, "https://dl.dropbox.com/u/39502907/Westnet_LowRes_2013.png");
		        newLayer(52.744606, 51.949345, -9.118652, -10.721283, 0.8, "https://dl.dropbox.com/u/39502907/Kerry%20Broadband%20OL_Fin.png");
		    }

		    // Sets the map on all overlays in the array.
		    function setAllMap(map) {
		        for (var i = 0; i < wispsArray.length; i++) {
		            wispsArray[i].setMap(map);
		        }
		    }

		    // Removes the overlays from the map, but keeps them in the array.
		    function clearOverlays() {
		        setAllMap(null);
		    }

		    // Shows any overlays currently in the array.
		    function showOverlays() {
		        setAllMap(map);
		    }

		    // Deletes all overlays in the array by removing references to them.
		    function deleteOverlays() {
		        clearOverlays();
		        wispsArray = [];
		    }

		</script>
	</head>
	<body onload="initialize()">
		<div id="Form" class="form">
			<img class="logo" border="0" src="https://dl.dropbox.com/u/39502907/IoffL%20logo.png" alt="Pulpit rock" width="130" height="30">
				<fieldset>
					<legend>Fixed Wireless</legend>
					<ol>
						<li>
							<input id="idWISPs" onchange="checkedState()" type="checkbox" name="WISPs" value="Bullseye">
							<label for="idWISPs">WISPs</label>
						</li>
						<li class="bottomli">
							<input id="idFWAs" onclick="MakeQuery()" type="checkbox" name="FWAs">
							<label for="idFWAs">FWAs</label>
						</li>
					</ol>
				</fieldset>				

			<form id="Network" name="providers">
				<fieldset>
					<legend>Mobile</legend>
					<ol>
						<li>
							<input id="idNetVoda" onclick="MakeQuery()" type="checkbox" name="sites" value="'Vodafone',">
							<label for="idNetVoda"><img src="dot-red.png" />Vodafone</label>
						</li>
						<li>
							<input id="idNetO2" onclick="MakeQuery()" type="checkbox" name="sites" value="'O2',">
							<label for="idNetO2"><img src="dot-blue.png" />O2</label>
						</li>
						<li>
							<input id="idNetMet" onclick="MakeQuery()" type="checkbox" name="sites" value="'Meteor',">
							<label for="idNetMet"><img src="dot-yellow.png" />Meteor</label>
						</li>
						<li class="bottomli">
							<input id="idNet3" onclick="MakeQuery()" type="checkbox" name="sites" value="'3',">
							<label for="idNet3"><img src="dot-green.png" />3 &nbsp;&nbsp; <img src="dot-purple.png" />NBS</label>
						</li>
					</ol>
				</fieldset>
			</form>

			<form id="Platform" name="technology">
				<fieldset>
					<ol>
						<li>
							<input id="idPlatGSM" onclick="MakeQuery()" name="platform" type="checkbox" value=" AND GSM = 'X'">
							<label for="idPlatGSM">GSM (Voice/Text)</label>
						</li>
						<li class="bottomli">
							<input id="idPlat3G" onclick="MakeQuery()" name="platform" type="checkbox" value=" AND UMTS = 'X'">
							<label for="idPlat3G">3G (Midband)</label>
						</li>
					</ol>
				</fieldset>
			</form>

			<form id="Eircom" name= "eircom">
				<fieldset>
					<legend>Eircom</legend>
					<ol>
						<li>
							<input id="idEirDSL" onclick="compQuery()" name="exchange" type="checkbox" value="'y',">
							<label for="idEirDSL"><img src="dot-white.png" />DSL</label>
						</li>
						<li class="bottomli">
							<input id="idEirNoDSL" onclick="compQuery()" name="exchange" type="checkbox" value="'n',">
							<label for="idEirNoDSL"><img src="dot-grey.png" />No DSL</label>
						</li>
					</ol>
				</fieldset>
			</form>

			<form id="AreaOverlay">
				<fieldset>
					<legend>Underlays</legend>
					<ol>
						<li>
							<input id="idAreaNone" onclick="overlay(layer1, 1236159, 'SELECT KML FROM 1236159 WHERE Urban = \u0027F\u0027')" name="area" type="radio" />
							<label for="idAreaNone">None</label>
						</li>
						<li>
							<input id="idAreaUrban" onclick="overlay(layer1, 1236159, 'SELECT KML FROM 1236159 WHERE Urban = \u0027X\u0027')" name="area" type="radio" value="1236159">
							<label for="idAreaUrban">Urban</label>
						</li>
						<li>
							<input id="idAreaNBS" onclick="overlay(layer1, 848418, 'SELECT KML FROM 848418')" name="area" type="radio" value="848418">
							<label for="idAreaNBS">NBS</label>
						</li>
						<li>
							<input id="idAreaCnt" onclick="overlay(layer1, 1242110, 'SELECT KML FROM 1242110')" name="area" type="radio" value="1242110">
							<label for="idAreaCnt">Counties</label>
						</li>				
						<li>
							<input id="idAreacExch"  onclick="overlay(layer1, 1214572, 'SELECT KML FROM 1214572')" name="area" type="radio" value="1214572">
							<label for="idAreacExch">Exchanges</label>
						</li>
						<li class="bottomli">
							<input id="idAreaInt" onclick="overlay(layer1, 1412833, 'SELECT coordinates FROM 1412833')" name="area" type="radio" value="1412833">
							<label for="idAreaInt">International</label>
						</li>
					</ol>
				</fieldset>
				<fieldset class="fldLast">
					<div class="c">
						<input type="button" class="centreform" onclick="fetchMarker()" value="Fetch Marker (3.5kms)" />
					</div>
				</fieldset>
				</form>
		</div>
		<div id="map_canvas"></div>
	</body>
</html>

