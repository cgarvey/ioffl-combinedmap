<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<title>Broadband viewer</title>
		
		<link rel=stylesheet href='form_demo23.css' type='text/css'>
		<style type="text/css">
			#map_canvas { height: 100% }
		</style>
	
		<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
		<script type="text/javascript">
			var marker = "null"
			var PlatQry="";
			var NetQry="Network NOT EQUAL TO 'F' ";
			var CombQry="";
			var currentLayer = null;
			var layer = null;
			var layer1 = null;
			var layer2 = null;
			var exchQry ="";
			var circle = null;
			var crosshair = null

			function initialize() {
				// Set centre of map
				var athlone = new google.maps.LatLng(53.5, -7.5);
				// Set background map, centre, zoom level, type
				map = new google.maps.Map(document.getElementById('map_canvas'), {
					center: athlone,
					zoom: 7,
					mapTypeId: 'roadmap'
				});

				// Add a Circle overlay to the map.
				circle = new google.maps.Circle({
					map: map,
					radius: 4500, // 4.5 kms
					strokeWeight: 0,
					stokeOpacity: 0
				});

				crosshair = new google.maps.MarkerImage('marker.png',
					// This marker is 10 pixels wide by 10 pixels tall.
					new google.maps.Size(10, 10),
					// The origin for this image is 0,0.
					new google.maps.Point(0,0),
					// The anchor for this image is at the base at 5,5.
					new google.maps.Point(5, 5)
				);
				
				marker = new google.maps.Marker({
					icon: crosshair,		
					map: map,
					position: new google.maps.LatLng(53.5, -10.5),
					draggable: true,
					title: 'Drag to your location'
				});
				
				circle.bindTo('center', marker, 'position');
			}
			
			function fetchMarker() {
				marker.position = map.getCenter(),
				circle.bindTo('center', marker, 'position');
				marker.setMap(map);
			}
			
			function formScan(formVar,formName,txtOut) {
				var formVar=document.formName.formVar;
				var i;
				txtOut="";
				for (i=0;i<formVar.length;i++) {
					if (formVar[i].checked) txtOut=txtOut + formVar[i].value;
					else txtOut=txtOut + "";
				}
			}

			function PlatQueryTxt() {
				var platform=document.technology.platform;
				var i;
				PlatQry="";
				for (i=0;i<platform.length;i++) {
					if (platform[i].checked) PlatQry=PlatQry + platform[i].value;
					else PlatQry=PlatQry + "";
				}
			}

			function NetQuery() {
				var sites=document.providers.sites;
				var i;
				NetQry="";
				
				for (i=0;i<sites.length;i++) {
					if (sites[i].checked) NetQry=NetQry + sites[i].value;
					else NetQry=NetQry + "";
				}
			}
			
			function ExchQry() {
				var exchange = document.eircom.exchange;
				var i;
				exchQry="";
				for (i=0;i<exchange.length;i++) {
					if (exchange[i].checked) exchQry=exchQry + exchange[i].value ;
					else exchQry=exchQry + "";
				}
			}

			function MakeQuery() {
				CombQry =""
				NetQuery();
				PlatQueryTxt();
				CombQry = "'Network' IN (" + NetQry + "'f')" + PlatQry;
				currentLayer=layer2
				clearLayer();
				
				layer2 = new google.maps.FusionTablesLayer(5488684, { query: "SELECT Location FROM 5488684 WHERE " + CombQry});
				stackLayers();
				currentLayer = layer2;
			}
			
			function compQuery() {
				currentLayer = layer;
				clearLayer();
				ExchQry();
				exchQry="(" + exchQry +"'f')";
				layer = new google.maps.FusionTablesLayer(1888694, { query: "SELECT Location FROM 1888694 WHERE 'Enabled' IN" + exchQry});
				stackLayers();
				currentLayer = layer;
			}
			
			function overlay(layerNo,dataset,querytxt) {
				currentLayer = layerNo;
				clearLayer();
				layer1 = new google.maps.FusionTablesLayer(dataset, {query: querytxt});
				stackLayers();
				currentLayer = layerNo;
			}
			
			function stackLayers() {
				if (layer1 != null) layer1.setMap(map);
				if (layer != null) layer.setMap(map);
				if (layer2 !=null) layer2.setMap(map);
			}

			function clearLayer() {
				if (currentLayer != null) currentLayer.setMap(null);
			}
		</script>
	</head>
	<body onload="initialize()">
		<div id="Form" class="form">
			<form id="Network" name="providers">
				<fieldset>
					<legend>Network</legend>
					<ol>
						<li>
							<input id="idNetVoda" onclick="MakeQuery()" type="checkbox" name="sites" value="'Vodafone',">
							<label for="idNetVoda"><img src="dot-red.png" />Vodafone</label>
						</li>
						<li>
							<input id="idNetO2" onclick="MakeQuery()" type="checkbox" name="sites" value="'O2',">
							<label for="idNetO2"><img src="dot-blue.png" />O2</label>
						</li>
						<li>
							<input id="idNetMet" onclick="MakeQuery()" type="checkbox" name="sites" value="'Meteor',">
							<label for="idNetMet"><img src="dot-yellow.png" />Meteor</label>
						</li>
						<li class="bottomli">
							<input id="idNet3" onclick="MakeQuery()" type="checkbox" name="sites" value="'3',">
							<label for="idNet3"><img src="dot-green.png" />3 &nbsp;&nbsp; <img src="dot-purple.png" />NBS</label>
						</li>
					</ol>
				</fieldset>
			</form>

			<form id="Platform" name="technology">
				<fieldset>
					<legend>Platform</legend>
					<ol>
						<li>
							<input id="idPlatGSM" onclick="MakeQuery()" name="platform" type="checkbox" value=" AND GSM = 'X'">
							<label for="idPlatGSM">GSM</label>
						</li>
						<li class="bottomli">
							<input id="idPlat3G" onclick="MakeQuery()" name="platform" type="checkbox" value=" AND UMTS = 'X'">
							<label for="idPlat3G">3G (Midband)</label>
						</li>
					</ol>
				</fieldset>
			</form>

			<form id="Eircom" name= "eircom">
				<fieldset>
					<legend>Eircom</legend>
					<ol>
						<li>
							<input id="idEirDSL" onclick="compQuery()" name="exchange" type="checkbox" value="'y',">
							<label for="idEirDSL"><img src="dot-white.png" />DSL</label>
						</li>
						<li class="bottomli">
							<input id="idEirNoDSL" onclick="compQuery()" name="exchange" type="checkbox" value="'n',">
							<label for="idEirNoDSL"><img src="dot-grey.png" />No DSL</label>
						</li>
					</ol>
				</fieldset>
			</form>

			<form id="AreaOverlay">
				<fieldset>
					<legend>Underlays</legend>
					<ol>
						<li>
							<input id="idAreaUrban" onclick="overlay(layer1,1236159,'SELECT KML FROM 1236159 WHERE Urban = \u0027X\u0027')" name="area" type="radio" value="1236159">
							<label for="idAreaUrban">Urban</label>
						</li>
						<li>
							<input id="idAreaNBS" onclick="overlay(layer1,848418,'SELECT KML FROM 848418')" name="area" type="radio" value="848418">
							<label for="idAreaNBS">NBS</label>
						</li>
						<li>
							<input id="idAreaCnt" onclick="overlay(layer1,1242110,'SELECT KML FROM 1242110')" name="area" type="radio" value="1242110">
							<label for="idAreaCnt">Counties</label>
						</li>				
						<li>
							<input id="idAreacExch"  onclick="overlay(layer1,1214572,'SELECT KML FROM 1214572')" name="area" type="radio" value="1214572">
							<label for="idAreacExch">Exchanges</label>
						</li>
						<li class="bottomli">
							<input id="idAreaInt" onclick="overlay(layer1,1412833,'SELECT coordinates FROM 1412833')" name="area" type="radio" value="1412833">
							<label for="idAreaInt">International</label>
						</li>
					</ol>
				</fieldset>
		
				<fieldset class="fldLast">
					<div class="c">
						<input type="button" class="centreform" onclick="fetchMarker()" value="Fetch Marker" />
					</div>
				</fieldset>
			</form>
		</div>
		<div id="map_canvas"></div>
	</body>
</html>

